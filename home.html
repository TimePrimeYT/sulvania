<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Accueil Sulvania</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    h1 { margin-bottom: 20px; }
    #contacts { margin-bottom: 20px; }
    button {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      border: none;
      background-color: #007bff;
      color: white;
    }
    button.logout { background-color: #dc3545; margin-left: 10px; }
  </style>
</head>
<body>
  <h1>Bienvenue, <span id="pseudoDisplay"></span></h1>
  <div id="contacts">Chargement des contacts...</div>

  <button id="joinVoice">Rejoindre le salon vocal</button>
  <button id="logout" class="logout">Déconnexion</button>

  <script>
    const pseudo = localStorage.getItem('pseudo');
    if (!pseudo) {
      alert('Tu dois être connecté');
      window.location.href = 'login.html';
    } else {
      document.getElementById('pseudoDisplay').textContent = pseudo;
    }

    async function loadContacts() {
      const resp = await fetch('/get-contacts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username: pseudo })
      });
      const data = await resp.json();
      const contDiv = document.getElementById('contacts');
      if (data.contacts.length === 0) {
        contDiv.textContent = 'Aucun contact.';
      } else {
        contDiv.innerHTML = '<h3>Contacts :</h3><ul>' +
          data.contacts.map(c => `<li>${c}</li>`).join('') +
          '</ul>';
      }
    }

    loadContacts();

    document.getElementById('joinVoice').onclick = () => {
      localStorage.setItem('roomId', 'sulvania_room'); // ID salon vocal fixe
      window.location.href = 'call.html';
    };

    document.getElementById('logout').onclick = () => {
      localStorage.removeItem('pseudo');
      window.location.href = 'login.html';
    };
  </script>
</body>
</html>

